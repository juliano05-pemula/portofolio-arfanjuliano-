  <!doctype html>
  <html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kalkulator</title>
    <style>
      :root{
        --bg:#0f1724;
        --panel:#0b1220;
        --btn:#1f2937;
        --accent:#06b6d4;
        --text:#e6eef6;
        --muted:#9aa7b6;
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      }
      *{box-sizing:border-box}
      html,body{height:100%;margin:0;background:linear-gradient(180deg,#071022 0%, var(--bg) 100%);color:var(--text)}
      .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:32px}

      .calculator{
        width:360px;
        max-width:96vw;
        background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
        border-radius:16px;
        padding:18px;
        box-shadow: 0 10px 30px rgba(2,6,23,0.6);
        border:1px solid rgba(255,255,255,0.04);
      }

      .display{
        background:transparent;
        padding:14px 12px;
        border-radius:10px;
        margin-bottom:12px;
        text-align:right;
      }
      .expr{color:var(--muted);font-size:14px;min-height:18px;overflow-x:auto}
      .result{font-size:32px;font-weight:600;line-height:1.1;min-height:40px}

      .pad{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
      button.key{
        background:var(--btn);
        color:var(--text);
        border:0;padding:14px;border-radius:10px;font-size:18px;
        box-shadow:0 3px 0 rgba(0,0,0,0.25);cursor:pointer;user-select:none
      }
      button.key:active{transform:translateY(1px)}
      button.op{background:linear-gradient(180deg,var(--accent),#0891b2);color:#042226;font-weight:600}
      button.func{background:rgba(255,255,255,0.03);color:var(--muted)}

      .wide{grid-column:span 2}

      .meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
      .small{font-size:13px;color:var(--muted)}

      /* responsive smaller screens */
      @media (max-width:420px){
        .result{font-size:26px}
        button.key{padding:12px;font-size:16px}
      }
      a {
          display: block;
          margin-top: 14px;
          color: #fcb500;
          text-decoration: none;
          font-weight: 600;
          text-align: center;
          
        }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="calculator" role="application" aria-label="Kalkulator sederhana">
        <div class="meta">
          <div class="small">Kalkulator — operasi dasar</div>
          <div class="small">Tip: pakai keyboard (1-9, + - * /, Enter untuk =, Backspace untuk ⌫)</div>
        </div>

        <div class="display" aria-live="polite">
          <div class="expr" id="expr">0</div>
          <div class="result" id="result">0</div>
        </div>

        <div class="pad">
          <button class="key func" data-action="clear">C</button>
          <button class="key func" data-action="back">⌫</button>
          <button class="key func" data-action="percent">%</button>
          <button class="key op" data-value="/">÷</button>

          <button class="key" data-value="7">7</button>
          <button class="key" data-value="8">8</button>
          <button class="key" data-value="9">9</button>
          <button class="key op" data-value="*">×</button>

          <button class="key" data-value="4">4</button>
          <button class="key" data-value="5">5</button>
          <button class="key" data-value="6">6</button>
          <button class="key op" data-value="-">−</button>

          <button class="key" data-value="1">1</button>
          <button class="key" data-value="2">2</button>
          <button class="key" data-value="3">3</button>
          <button class="key op" data-value="+">+</button>

          <button class="key" data-value="0" style="grid-column:span 2">0</button>
          <button class="key" data-value=".">.</button>
          <button class="key op" data-action="equals">=</button>
        </div>
      </div>
    </div>

    <script>
      (function(){
        const exprEl = document.getElementById('expr');
        const resEl = document.getElementById('result');
        let expr = '';

        function setDisplay(){
          exprEl.textContent = expr || '0';
          try{
            const value = expr && /[0-9]$/.test(expr) ? safeEval(expr) : '';
            resEl.textContent = (value !== '' && isFinite(value)) ? formatNumber(value) : (expr? '': '0');
          }catch(e){
            resEl.textContent = '';
          }
        }

        function formatNumber(n){
          // remove trailing .0 if integer
          if (Math.abs(n) < 1e15 && Number.isInteger(n)) return n.toString();
          return parseFloat(n.toFixed(12)).toString();
        }

        function safeEval(input){
          // allow only digits, operators, parentheses and dots
          if(!/^[0-9+\-*/().%\s]*$/.test(input)) throw new Error('invalid');
          // replace unicode minus signs and division symbols if present
          const cleaned = input.replace(/÷/g, '/').replace(/×/g, '*').replace(/−/g,'-');
          // handle percent: convert '50%' => '(50/100)'
          const withPercent = cleaned.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
          // evaluate via Function in strict mode to reduce risk
          // Note: this is meant for local use only
          // eslint-disable-next-line no-new-func
          return Function('"use strict"; return (' + withPercent + ')')();
        }

        function append(ch){
          // prevent starting with an operator (except -)
          if(expr === '' && /[+*/]/.test(ch)) return;
          // prevent two operators in a row
          if(/[+\-*/.]/.test(last()) && /[+\-*/.]/.test(ch)){
            // allow a minus after operator for negative numbers
            if(ch === '-' && !(/[\(]/.test(last()))){
              expr += ch; setDisplay(); return;
            }
            // replace previous operator with new one (except dot)
            if(ch !== '.') expr = expr.slice(0, -1) + ch;
            setDisplay(); return;
          }
          expr += ch;
          setDisplay();
        }

        function last(){ return expr.slice(-1); }

        function clearAll(){ expr = ''; setDisplay(); }
        function backspace(){ expr = expr.slice(0,-1); setDisplay(); }

        function percent(){
          // append % which will be handled by safeEval
          if(expr && /\d$/.test(expr)) expr += '%';
          setDisplay();
        }

        function equals(){
          if(!expr) return;
          try{
            const v = safeEval(expr);
            expr = String(v);
            setDisplay();
          }catch(e){
            resEl.textContent = 'Error';
          }
        }

        document.querySelectorAll('button.key').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const v = btn.dataset.value;
            const action = btn.dataset.action;
            if(action){
              if(action === 'clear') clearAll();
              else if(action === 'back') backspace();
              else if(action === 'percent') percent();
              else if(action === 'equals') equals();
            }else if(v){
              append(v);
            }
          });
        });

        // keyboard support
        window.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter') { equals(); e.preventDefault(); }
          else if(e.key === 'Backspace') backspace();
          else if(e.key === 'Escape') clearAll();
          else if(e.key === '%') { percent(); }
          else if(/^[0-9]$/.test(e.key)) append(e.key);
          else if(e.key === '.') append('.');
          else if(['+','-','*','/','(',')'].includes(e.key)) append(e.key);
        });

        // initial
        setDisplay();
      })();
    </script>
    <a href="index.html">Kembali ke Portfolio</a>
  </body>
  </html>
